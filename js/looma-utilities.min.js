"use strict";var LOOMA={playMedia:function(e){var t=encodeURIComponent(e.getAttribute("data-fn")),n=encodeURIComponent(e.getAttribute("data-fp")),o=encodeURIComponent(e.getAttribute("data-dn")),a=encodeURIComponent(e.getAttribute("data-ndn")),i=LOOMA.readStore("language","cookie");switch(e.getAttribute("data-ft").toLowerCase()){case"video":case"mp4":case"m4v":case"mov":window.location="video?fn="+t+"&fp="+n+"&dn="+o;break;case"evi":window.location="looma-play-edited-video.php?fn="+t+"&fp="+n+"&id="+e.getAttribute("data-mongoid")+"&dn="+o;break;case"image":case"jpg":case"jpeg":case"png":case"gif":window.location="image?fn="+t+"&fp="+n;break;case"audio":case"mp3":case"m4a":window.location="audio?fn="+e.getAttribute("data-fn")+"&fp="+e.getAttribute("data-fp")+"&dn="+e.getAttribute("data-dn");break;case"pdf":case"document":case"chapter":case"section":window.location="pdf?fn="+encodeURIComponent(e.getAttribute("data-fn"))+"&fp="+encodeURIComponent(e.getAttribute("data-fp"))+"&zoom="+e.getAttribute("data-zoom")+"&len="+e.getAttribute("data-len")+"&page="+e.getAttribute("data-page");break;case"text":var s=encodeURIComponent(e.getAttribute("data-mongoId"));window.location="text?id="+s+"&lang="+("native"===i?"np":"en");break;case"html":n=encodeURIComponent(e.getAttribute("data-fp")),t=encodeURIComponent(e.getAttribute("data-fn"));window.location="html?fp="+n+"&fn="+t;break;case"book":n=encodeURIComponent(e.getAttribute("data-fp")),o=e.getAttribute("data-dn"),a=e.getAttribute("data-ndn"),s=e.getAttribute("data-prefix");window.location="book?fp="+n+"&prefix="+s+"&dn="+o+"&ndn="+a;break;case"looma":n=encodeURIComponent(e.getAttribute("data-url"));window.location=n;break;case"epaath":case"ep":2015==e.getAttribute("data-epversion")?(n=encodeURIComponent(e.getAttribute("data-fp")),t=encodeURIComponent(e.getAttribute("data-fn")+"/start.html"),window.location="epaath?epversion=2015&fp="+n+"&fn="+t):window.location="epaath?epversion=2019&ole="+e.getAttribute("data-ole")+"&lang="+e.getAttribute("data-lang")+"&grade="+e.getAttribute("data-grade").substr(5);break;case"lesson":LOOMA.clearStore("lesson-plan-index","session"),window.location="lesson?id="+e.getAttribute("data-mongoid")+"&lang="+("native"===i?"np":"en");break;case"game":window.location="game?id="+e.getAttribute("data-mongoid")+"&class="+e.getAttribute("data-class")+"&subject="+e.getAttribute("data-subject")+"&type="+e.getAttribute("data-type");break;case"map":window.location="map?id="+e.getAttribute("data-mongoid");break;case"slideshow":window.location="slideshow?id="+e.getAttribute("data-mongoid");break;case"history":window.location="history?id="+e.getAttribute("data-mongoid");break;default:console.log("ERROR: in LOOMA.playMedia(), unknown type: "+e.getAttribute("data-ft"))}},makeActivityButton:function(a,i,s){$.post("looma-database-utilities.php",{cmd:"openByID",collection:"activities",id:a},function(e){var t;e&&(t="fp"in e&&e.fp?e.fp:LOOMA.filepath(e.ft,e.fn));var n="EP"===e.ft&&"nepali"===e.subject?"np":"en",o=e.fn||e.nfn,n=$('<button class="activity play img" data-id="'+a+'" data-fn="'+o+'" data-fp="'+t+'" data-ft="'+e.ft+'" data-lang="'+n+'" data-dn="'+e.dn+'" data-ndn="'+e.ndn+'" data-prefix="'+e.prefix+'" data-zoom="'+e.zoom+'" data-url="'+e.url+'" data-grade="'+e.grade+'" data-class="'+e.class+'" data-subject="'+e.subject+'" data-type="'+e.presentation_type+'" data-epversion="'+e.version+'" data-ole="'+e.oleID+'" data-mongoID="'+i+'" >'),o=!("fn"in e)&&"nfn"in e?e.nfn:"fn"in e?e.fn:null;(o="EP"==e.ft&&e.thumb?"../ePaath/"+e.thumb:"history"!==e.ft&&"slideshow"!==e.ft&&"map"!==e.ft||!e.thumb?e.thumb?e.fp+e.thumb:o?LOOMA.thumbnail(o,e.fp,e.ft):null:e.thumb)&&n.append($('<img alt="" loading="lazy" draggable="false" src="'+o+'">')),e="english"===language?"dn"in e?e.dn:e.ndn:"ndn"in e?e.ndn:e.dn,n.append($('<span class="dn">').text(e)),n.click(function(){LOOMA.playMedia(this)}),n.appendTo(s)},"json")},makeChapterButton:function(i,s){$.post("looma-database-utilities.php",{cmd:"openByID",collection:"chapters",id:i},function(e){console.log(e);var t=LOOMA.parseCH_ID(i),n=t.currentSubjectFull,o=t.currentGradeNumber,a=n+"-"+o,t=LOOMA.filepath("textbook")+"Class"+o+"/"+n+"/",o=e.pn||e.npn,n=e.len||e.nlen,o=$('<button class="chapter play img" data-fn="'+a+'.pdf" data-fp="'+t+'" data-ft="chapter" data-zoom="100" data-page"'+o+'" data-len"'+n+'" data-pg="'+o+'" >'),a=t+a+(e.pn?"_thumb.jpg":"-Nepali_thumb.jpg");o.append($('<img alt="" draggable="false" src="'+a+'">')),o.append($("<span>").text(e.dn)),o.click(function(){saveState(),LOOMA.playMedia(this)}),o.appendTo(s)},"json")},extension:function(e){return e.substring(e.lastIndexOf(".")+1)},filepath:function(e,t){var n,o="../";switch(e){case"mp3":case"m4a":case"audio":n=o+"content/audio/";break;case"mp4":case"video":case"m4v":case"mov":case"mp5":n=o+"content/videos/";break;case"jpg":case"jpeg":case"gif":case"png":case"image":n=o+"content/pictures/";break;case"pdf":n=o+"content/pdfs/";break;case"epaath":case"EP":n=o+"content/epaath/activities/";break;case"html":n=o+"content/html/";break;case"textbook":n=o+"content/textbooks/";break;default:n=""}return n},thumbnail:function(e,t,n){var o="../",a="";return n&&("chapter"==(n=n.toLowerCase())?a=o+"content/textbooks/"+t+e+"_thumb.jpg":t&&0<=t.indexOf("/Khan/")?a=o+"content/Khan/thumbnail.png":t&&0<=t.indexOf("/W4S/")?a=o+"content/W4S/thumbnail.png":"mp3"==n||"m4a"==n||"audio"==n?a=(t||o+"content/audio/")+"thumbnail.png":"mp4"==n||"mp5"==n||"m4v"==n||"mov"==n||"video"==n?a=(t||o+"content/videos/")+e.substr(0,e.lastIndexOf("."))+"_thumb.jpg":"jpg"==n||"jpeg"==n||"gif"==n||"png"==n||"image"==n?a=(t||o+"content/pictures/")+e.substr(0,e.lastIndexOf("."))+"_thumb.jpg":"pdf"==n||"Document"===n?a=(t||o+"content/pdfs/")+e.substr(0,e.lastIndexOf("."))+"_thumb.jpg":"html"==n?a=(t||o+"content/html/")+e.substr(0,e.lastIndexOf("."))+"_thumb.jpg":"EP"==n||"ep"==n||"epaath"==n?a=o+"content/epaath/activities/"+e+"/thumbnail.jpg":"text"==n?a="images/textfile.png":"lesson"==n?a="images/lesson2.png":"evi"==n?a="images/video.png":"history"==n?a="images/history.png":"map"==n?a="images/maps.png":"game"==n?a="images/games.png":"slideshow"==n?a="images/play-slideshow-icon.png":"looma"==n&&(a="images/LoomaLogo_small.png")),a},typename:function(e){var t={mp4:"video",mov:"video",mp5:"video",m4v:"video",jpg:"image",png:"image",gif:"image",JPG:"image",pdf:"pdf",mp3:"audio",m4a:"audio",EP:"ePaath",html:"HTML",looma:"Looma Page",chapter:"Chapter",text:"Text File"};return e in t?t[e]:e},capitalize:function(e){return e&&e.charAt(0).toUpperCase()+e.slice(1)},setStore:function(e,t,n){"local"==n?localStorage.setItem(e,t):"session"==n?sessionStorage.setItem(e,t):"cookie"==n?document.cookie=e+"="+encodeURIComponent(t)+"; path=/":"session-cookie"==n?document.cookie=e+"="+encodeURIComponent(t)+"; expires=0; path=/":console.log("LOOMA.utilities.setStore: unknown localStore type: "+n)},readStore:function(e,t){return"local"==t?localStorage.getItem(e):"session"==t?sessionStorage.getItem(e):"cookie"==t||"session-cookie"==t?LOOMA.readCookie(e):(console.log("LOOMA.utilities.readStore: unknown localStore type: "+t),null)},clearStore:function(e,t){return"local"==t?localStorage.removeItem(e):"session"==t?sessionStorage.removeItem(e):void("cookie"==t||"session-cookie"==t?document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT":console.log("LOOMA.utilities.readStore: unknown localStore type: "+t))},readCookie:function(e){for(var t=document.cookie.split(";"),n=0,o=t.length;n<o;n++){var a=" "==t[n].slice(0,1)?t[n].slice(1):t[n];if((a=(a=decodeURIComponent(a)).split("="))[0]==e)return a[1]}return null},saveForm:function(e,t){var n=e.serializeArray();LOOMA.setStore(t,JSON.stringify(n),"session"),console.log("saving: "+JSON.stringify(e.serializeArray()))},restoreForm:function(n,e){e=JSON.parse(LOOMA.readStore(e,"session"));return e&&0<e.length&&$.each(e,function(e,t){-1===["key1","key2","key3","key4"].indexOf(t.name)&&(n[0].elements[t.name].value=t.value)}),e},loggedIn:function(){return LOOMA.readCookie("login")},translate:function(e){"native"==e?($(".english-keyword, .english").hide(),$(".native-keyword,  .native").show(),$(".english-tip").removeClass("yes-show"),$(".native-tip").addClass("yes-show")):($(".english-keyword, .english").show(),$(".native-keyword,  .native").hide(),$(".english-tip").addClass("yes-show"),$(".native-tip").removeClass("yes-show")),"english"==e?$("#flag").attr("src","images/native-flag.png"):$("#flag").attr("src","images/english-flag.png")},translatableSpans:function(e,t){return"english"==LOOMA.readStore("language","cookie")?"<span class='english-keyword style='display:inline-block''>"+e+"<span class='xlat'>"+t+"</span></span><span class='native-keyword' style='display:none'>"+t+"<span class='xlat'>"+e+"</span></span>":"<span class='english-keyword' style='display:none'>"+e+"<span class='xlat'>"+t+"</span></span><span class='native-keyword' style='display:inline-block'>"+t+"<span class='xlat'>"+e+"</span></span>"},lookup:function(e,t,n){return console.log('LOOMA.lookup: dictionary lookup - word is "'+e+'"'),$.ajax("looma-dictionary-utilities.php",{type:"GET",cache:!1,crossDomain:!0,dataType:"json",data:"cmd=lookup&word="+encodeURIComponent(e.toLowerCase()),error:n,success:t}),!1},reverselookup:function(e,t,n){return console.log('LOOMA.reverselookup: dictionary lookup - word is "'+e+'"'),$.ajax("looma-dictionary-utilities.php",{type:"GET",cache:!1,crossDomain:!0,dataType:"json",data:"cmd=reverselookup&word="+encodeURIComponent(e.toLowerCase()),error:n,success:t}),!1},defHTML:function(e,t){var n=$("<div />"),o=$('<div id="english"/>'),a=$('<div id="nepali"/>'),i=$('<div id="partOfSpeech"/>'),s=$('<div id="definition"/>');o.text(e.en),a.text(e.np),i.html("<i>"+e.part+"</i>");var p,c=e.def.toLowerCase();"past tense of"!=c&&"comparative form of"!=c&&"superlative form of"!=c&&"past participle of"!=c&&"present participle of"!=c&&"past tense and past participle of"!=c&&"third person singular of"!=c||(c+=" "+e.rw),c=c.replace(/\;/g,";</p><p>"),s.html(c),e.img&&(p=e.img+".jpg",p=$('<img id="definitionThumb" alt="" src="../content/dictionary images/'+p+'"/>')),n.append(o,a,i,s,p),t&&(p=$('<div id="rwdef"/>'),t.def=t.def.replace(/\;/g,"</p><p>"),p.html(t.def),n.append(p));c=c.length;return t&&(c+=t.length),c<70?s.addClass("largeWord"):c<150?s.addClass("mediumWord"):s.addClass("smallWord"),n},define:function(e,n,t){LOOMA.lookup(e,function(t){console.log(t.en+" DEFINED"),t.rw?LOOMA.lookup(t.rw,function(e){n(LOOMA.defHTML(t,e))},function(){n(LOOMA.defHTML(t))}):n(LOOMA.defHTML(t))},function(){t()})},reversedefine:function(e,t,n){LOOMA.reverselookup(e,function(e){console.log(e.np+" DEFINED"),t(LOOMA.defHTML(e))},function(){n()})},definition_only:function(e,n,t){LOOMA.lookup(e,function(t){t.rw?LOOMA.lookup(t.rw,function(e){"past tense of"==t.def||"comparative form of"==t.def||"superlative form of"==t.def||"past participle of"==t.def||"present participle of"==t.def||"past tense and past participle of"==t.def||"third person singular of"==t.def?n(t.def+" "+t.rw):n(t.def)},function(){n(t.def)}):n(t.def)},function(){t()})},popupDefinition:function(e,n){LOOMA.define(e,function(e){$("#popup").remove();var t=$('<div id="popup"/>');t.append(e),LOOMA.alert(t.html(),n,!0)},function(){})},wordlist:function(e,t,n,o,a,i,s){var p="cmd=list";return e&&(p+="&class="+encodeURIComponent(e)),t&&(p+="&subject="+encodeURIComponent(t)),n&&(p+="&ch_id="+encodeURIComponent(n)),o&&(p+="&count="+o.toString()),a&&(p+="&random="+encodeURIComponent(a)),console.log(p),$.ajax("looma-dictionary-utilities.php",{type:"GET",cache:!1,crossDomain:!0,dataType:"json",data:p,error:s,success:i}),!1},dictionarySearchall:function(e,t,n){return $.ajax("looma-dictionary-utilities.php",{type:"GET",cache:!1,crossDomain:!0,dataType:"json",data:"cmd=searchall&word="+encodeURIComponent(e.toLowerCase()),error:n,success:t}),!1},dictionaryDelete:function(e,t,n){return $.ajax("looma-dictionary-utilities.php",{type:"GET",cache:!1,crossDomain:!0,dataType:"json",data:"cmd=delete&wordID="+encodeURIComponent(e),error:n,success:t}),!1},dictionaryUpdate:function(e,t,n){return $.ajax("looma-dictionary-utilities.php",{type:"GET",cache:!1,crossDomain:!0,dataType:"json",data:"cmd=update&wordID="+encodeURIComponent(e[0])+"&wordEn="+encodeURIComponent(e[1])+"&wordNp="+encodeURIComponent(e[2])+"&wordPart="+encodeURIComponent(e[3])+"&wordPlural="+encodeURIComponent(e[4])+"&wordRw="+encodeURIComponent(e[5])+"&wordCh_id="+encodeURIComponent(e[6])+"&wordDef="+encodeURIComponent(e[7]),error:n,success:t}),!1},picturewordlist:function(e,t,n,o,a,i,s){var p="cmd=list&picturesonly=true";return e&&(p+="&class="+encodeURIComponent(e)),t&&(p+="&subject="+encodeURIComponent(t)),n&&(p+="&ch_id="+encodeURIComponent(n)),o&&(p+="&count="+o.toString()),a&&(p+="&random="+encodeURIComponent(a)),console.log(p),$.ajax("looma-dictionary-utilities.php",{type:"GET",cache:!1,crossDomain:!0,dataType:"json",data:p,error:s,success:i}),!1},dictionaryLookupCh_id:function(e,t,n){return $.ajax("looma-dictionary-utilities.php",{type:"GET",cache:!1,crossDomain:!0,dataType:"json",data:"cmd=lookupCh_id&ch_id="+encodeURIComponent(e),error:n,success:t}),!1},dictionaryAddCh_id:function(e,t){return $.ajax("looma-dictionary-utilities.php",{type:"GET",cache:!1,crossDomain:!0,dataType:"json",data:"cmd=addCh_id&ch_id="+encodeURIComponent(e)+"&word="+encodeURIComponent(t)}),!1},rtl:function(e){e.setSelectionRange&&e.setSelectionRange(0,0)},setTheme:function(){var e=(e=LOOMA.readStore("theme","session-cookie"))||"looma";return $("#theme-stylesheet").attr("href","css/looma-theme-"+e+".css"),location.reload(),e},changeTheme:function(e){LOOMA.setStore("theme",e,"session-cookie"),LOOMA.setTheme()},changeVoice:function(e){LOOMA.setStore("voice",e,"cookie"),console.log("LOOMA.changeVoice() voice changed to ",e)},ch_id:function(e,t,n,o){var a={math:"M",science:"S",english:"EN",nepali:"NP",socialstudies:"SS",vocation:"V",health:"H"};if(ch_id="",!(1<=e&&e<=8))return"";if(ch_id=e,!(0<=a.indexOf(t)))return"";if(ch_id+=a[t],n)if(1<=n&&n<=9)ch_id+="0"+n+".";else{if(!(n<=99))return"";ch_id+=n+"."}if(1<=o&&o<=9)ch_id+="0"+o;else{if(!(o<=99))return"";ch_id+=o}return ch_id},parseCH_ID:function(e){var t={currentSection:null,currentChapter:null,currentSubject:null,currentGradeNumber:null,currentGradeFolder:null,currentSubjectFull:null,chprefix:null};return!e||(e=e.toString().match(/^([1-9]|10)(Ma|M|N|Sa|S|SSa|SS|EN|H|V)([0-9][0-9])(\.[0-9][0-9])?$/))&&(t.currentGradeNumber=e[1],t.currentSubject=e[2],t.currentSection=e[4]?e[3]:null,t.currentChapter=e[4]?e[4].substr(1):e[3],t.currentGradeFolder="Class"+e[1],t.currentSubjectFull={EN:"English",N:"Nepali",M:"Math",Ma:"Math",S:"Science",Sa:"Science",SS:"SocialStudies",SSa:"SocialStudies",H:"Health",V:"Vocation"}[e[2]],t.chprefix=e[1]+e[2]),t},ch_idGrade:function(e){},ch_idSubject:function(e){},ch_idUnit:function(e){},ch_idChapter:function(e){},ch_idFilepath:function(e){e=LOOMA.parseCH_ID(e);return"../content/textbooks/Class"+e.currentGradeNumber+"/"+e.currentSubjectFull+"/"+e.currentSubjectFull+"-"+e.currentGradeNumber+".pdf"}};function enterFS(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function leaveFS(e){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozExitFullScreen?document.mozExitFullScreen():document.msExitFullScreen&&document.msExitFullScreen()}function $_GET(e){var o={};return window.location.href.replace(location.hash,"").replace(/[?&]+([^=&]+)=?([^&]*)?/gi,function(e,t,n){o[t]=void 0!==n?n:""}),e?o[e]||null:o}LOOMA.getCH_ID=function(e,t,n,o){LOOMA.closePopup(),o||LOOMA.makeTransparent(),$(document.body).append("<div class='popup textEntry' id='ch_id_popup'><button class='popup-button dismiss-popup'><b>X</b></button>"+e+"<button id='close-popup' class='popup-button'>"+LOOMA.translatableSpans("cancel","रद्द गरेर")+"</button><div id='ch_id'><span> Class: </span><select id='classSelect'><option value=''></option><option value='1'>1</option><option value='2'>2</option><option value='3'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option>  </select> <span> Subject: </span><select id='subjectSelect'><option value=''></option><option value='EN'>English</option><option value='M'>Math</option><option value='N'>Nepali</option><option value='S'>Science</option><option value='SS'>Soc.Studies</option></select> <span> Chapter: </span> <select id='chapterSelect'></select></div><button id='confirm-popup' class='popup-button'>"+LOOMA.translatableSpans("OK","ठिक छ")+"</button></div>").hide().fadeIn(1e3),$("#classSelect, #subjectSelect").change(function(){$("#chapterSelect").empty(),""!=$("#classSelect").val()&&""!=$("#subjectSelect").val()&&$.post("looma-database-utilities.php",{cmd:"textChapterList",class:$("#classSelect").val(),subject:$("#subjectSelect").val()},function(e){console.log(e),$("#chapterSelect").append(e)},"html")}),$("#confirm-popup").click(function(){var e=$("#ch_id #chapterSelect").val();console.log("select CH_ID returned ",e),LOOMA.closePopup(),t(e)}),$(".dismiss-popup, #close-popup").click(function(){LOOMA.closePopup(),n()})},LOOMA.sound=function(e){e.Play()},LOOMA.speak=function(e,t,n,o){var a,i=o||2/3;if(""!=e){!t&&speechSynthesis&&-1==navigator.userAgent.indexOf("Chromium")&&(t="synthesis"),t=t||"mimic",n=n||(LOOMA.readStore("voice","cookie")||"cmu_us_bdl"),console.log('speaking : "'+e+'" using engine: '+t+" and voice: "+n);var s=document.getElementsByClassName("speak")[0];if(null==LOOMA.speak.animationsInProgress&&(LOOMA.speak.animationsInProgress=0),null==LOOMA.speak.speechQueue&&(LOOMA.speak.speechQueue=[]),window.onbeforeunload=function(){console.log("Leaving this page. Stopping Audio"),LOOMA.speak.cleanup()},LOOMA.speak.activate=function(){s&&(LOOMA.speak.animationsInProgress+=1,1==LOOMA.speak.animationsInProgress&&(s.oldOpacity=$(s).css("opacity"),s.oldWidth=$(s).css("width"),s.oldHeight=$(s).css("height"),$(s).animate({opacity:1,width:2*parseFloat(s.oldWidth)+"px",height:2*parseFloat(s.oldHeight)+"px"},500)))},LOOMA.speak.disable=function(){s&&(--LOOMA.speak.animationsInProgress,0==LOOMA.speak.animationsInProgress&&$(s).animate({opacity:s.oldOpacity,width:s.oldWidth,height:s.oldHeight},500))},LOOMA.speak.cleanup=function(){speechSynthesis.speaking?speechSynthesis.pause():(LOOMA.speak.playingAudio.pause(),LOOMA.speak.playingAudio=null,LOOMA.speak.speechQueue=[],LOOMA.speak.disable())},"synthesis"===t)speechSynthesis.speaking?speechSynthesis.paused?speechSynthesis.resume():speechSynthesis.pause():((t=new SpeechSynthesisUtterance(e)).rate=i,speechSynthesis.speak(t));else if(null!=LOOMA.speak.playingAudio)console.log("Stopping Audio"),LOOMA.speak.cleanup();else{console.log("Playing Audio: "+e);var p=e.split(/[.,?!;:]/);console.log("Speaking "+p.length+" phrases.");for(var c=null,l=null,r=0;r<p.length;r++){var u=p[r],u=n?"looma-mimic.php?text="+encodeURIComponent(u)+"&voice="+encodeURIComponent(n)+"&rate="+encodeURIComponent(i):"looma-mimic.php?text="+encodeURIComponent(u),u=new Audio(u);u.onended=function(){console.log("End of Phrase");var e=LOOMA.speak.speechQueue.pop();null!=e?(LOOMA.speak.playingAudio=e,console.log("Playing Next Phrase"),a=e.play()):(console.log("Done with all phrases."),LOOMA.speak.cleanup())},null==c?l=u:LOOMA.speak.speechQueue.unshift(u),c=u}LOOMA.speak.playingAudio=l,console.log("Playing Phrase"),a=l.play().then(function(){console.log("Play started")}).catch(function(e){console.log("Play promise error: ",e)}),console.log("promise is ",a),LOOMA.speak.activate()}}},LOOMA.toggleFullscreen=function(){var e=(e=document.getElementById("video-fullscreen"))||document.getElementById("fullscreen");(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullscreenElement||document.msFullscreenElement?leaveFS:enterFS)(e)},LOOMA.makeTransparent=function(e){(e=e||$("body > div")).addClass("all-transparent"),e.css("pointerEvents","none"),$(document).keydown(function(e){27==e.keyCode&&LOOMA.closePopup()})},LOOMA.makeOpaque=function(e){(e=e||$("body > div")).removeClass("all-transparent"),e.css("pointerEvents","auto")},LOOMA.closePopup=function(){$(".popup").fadeOut(1e3).remove();var e=$("body > div");e.removeClass("all-transparent"),LOOMA.makeOpaque(e),$(document).off("keydown")},LOOMA.alert=function(e,t,n,o){var a,i,s;LOOMA.closePopup(),n||LOOMA.makeTransparent(),(0<$("#fullscreen").length?$("#fullscreen"):$(document.body)).append("<div class= 'popup'><button class='popup-button dismiss-popup'><b>X</b></button>"+e+"<button id ='close-popup' class ='popup-button'>"+LOOMA.translatableSpans("OK","ठिक छ")+"</button></div>").hide().fadeIn(1e3),$("#close-popup, .dismiss-popup").click(function(){o&&o(),LOOMA.closePopup()}),t&&(a=t-1,(i=$("#close-popup")).html(LOOMA.translatableSpans("OK ("+Math.round(a+1)+")","ठिक छ("+Math.round(a+1)+")")),clearInterval(s),s=setInterval(function(){a<=0&&(clearInterval(s),o&&o(),LOOMA.closePopup()),--a,i.html(LOOMA.translatableSpans("OK ("+Math.round(a+1)+")","ठिक छ("+Math.round(a+1)+")"))},1e3))},LOOMA.confirm=function(e,t,n,o){LOOMA.closePopup(),o||LOOMA.makeTransparent(),$(document.body).append("<div class='popup confirmation'><button class='popup-button dismiss-popup'><b>X</b></button> "+e+"<button id='close-popup' class='popup-button'>"+LOOMA.translatableSpans("cancel","रद्द गरेर")+"</button><button id='confirm-popup' class='popup-button'>"+LOOMA.translatableSpans("confirm","निश्चय गर्नुहोस्")+"</button></div>").hide().fadeIn(1e3),$("#confirm-popup").click(function(){LOOMA.closePopup(),t()}),$(".dismiss-popup, #close-popup").click(function(){LOOMA.closePopup(),n()})},LOOMA.prompt=function(e,t,n,o){LOOMA.closePopup(),o||LOOMA.makeTransparent(),$(document.body).append("<div class='popup textEntry'><button class='popup-button dismiss-popup'><b>X</b></button>"+e+"<button id='close-popup' class='popup-button'>"+LOOMA.translatableSpans("cancel","रद्द गरेर")+"</button><input id='popup-input' autofocus></input><button id='confirm-popup' class='popup-button'>"+LOOMA.translatableSpans("OK","ठिक छ")+"</button></div>").hide().fadeIn(1e3),$("#popup-input").focus(),$("#popup-input").on("keydown",function(e){13===e.keyCode&&(console.log("PROMPT returned ",$("#popup-input").val()),t($("#popup-input").val()),LOOMA.closePopup())}),$("#confirm-popup").click(function(){console.log("PROMPT returned ",$("#popup-input").val()),t($("#popup-input").val()),LOOMA.closePopup()}),$(".dismiss-popup, #close-popup").click(function(){LOOMA.closePopup(),n()})},LOOMA.clean=function(e){return e.replace(/[^a-zA-Z0-9 \.\-\_]/g,"").trim()},LOOMA.escapeHTML=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},LOOMA.download=function(e,t){$.ajax("looma-database-utilities.php",{type:"GET",cache:!1,crossDomain:!0,dataType:"json",data:encodeURIComponent("cmd=download&name="+e+"&path="+t),error:function(){},success:function(){}})},LOOMA.CH_IDregex=/([1-9]|10|11|12)(EN|Ena|Sa|S|SF|Ma|M|SSa|SS|N|H|V|CS)[0-9]{2}(\.[0-9]{2})?/;var loginname=LOOMA.loggedIn();Date.prototype.getWeek=function(){var e=new Date(this.getTime());e.setHours(0,0,0,0),e.setDate(e.getDate()+3-(e.getDay()+6)%7);var t=new Date(e.getFullYear(),0,4);return 1+Math.round(((e.getTime()-t.getTime())/864e5-3+(t.getDay()+6)%7)/7)};